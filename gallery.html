<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Journey | Spencer Green Hotel Batu</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="assets/js/global-config.js"></script>

    <style>
        /* --- SPENCER THEME VARS --- */
        :root { --gold: #D4AF37; --emerald: #1B4D3E; --dark: #111; }
        
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Montserrat', sans-serif; 
            background: var(--dark); 
            height: 100vh; 
            overflow: hidden; /* Penting agar tidak ada scrollbar ganda */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- FULLSCREEN BACKGROUND LAYERS --- */
        /* Kita butuh 2 layer untuk efek cross-fade yang halus */
        .bg-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 1s ease-in-out;
        }
        #bg-back { z-index: 1; opacity: 1; }
        #bg-front { z-index: 2; opacity: 0; }
        
        /* Overlay hitam agar teks/header terbaca */
        .bg-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); /* Gelapkan background */
            z-index: 3;
            pointer-events: none;
        }

        /* --- HERO TEXT (Kiri Atas) --- */
        .hero-content {
            position: absolute;
            top: 25%; /* Sesuaikan posisi vertikal */
            left: 8%; /* Sesuaikan posisi horizontal */
            z-index: 10;
            color: #fff;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }
        .hero-subtitle { 
            color: var(--gold); letter-spacing: 3px; font-weight: 600; 
            text-transform: uppercase; font-size: 1rem; margin-bottom: 10px; display: block;
            animation: fadeUp 1s ease forwards;
        }
        .hero-title { 
            font-family: 'Cormorant Garamond', serif; font-size: 4.5rem; margin: 0; 
            line-height: 1.1;
            animation: fadeUp 1s ease 0.3s forwards; opacity: 0;
        }

        /* --- 3D CAROUSEL CONTAINER (Pojok Kanan Bawah) --- */
        .carousel-viewport {
            position: absolute;
            bottom: 5%;  /* Posisi dari bawah */
            right: 5%;   /* Posisi dari kanan */
            width: 500px;
            height: 400px;
            perspective: 1200px; /* Titik hilang 3D */
            z-index: 20;
            /* Border debug sementara - hapus jika sudah pas */
            /* border: 1px dashed red; */ 
        }

        .carousel-stage {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Efek putar halus */
            /* INI KUNCI EFEK TIKTOK: Miringkan wadahnya */
            transform: rotateX(-10deg) rotateY(-20deg) rotateZ(5deg); 
        }

        /* ITEM FOTO DI CAROUSEL */
        .carousel-item {
            position: absolute;
            width: 160px;  /* Ukuran thumbnail */
            height: 240px;
            top: 50%;
            left: 50%;
            margin-top: -120px; /* Setengah height agar center */
            margin-left: -80px; /* Setengah width agar center */
            
            background: #000;
            border: 2px solid rgba(212, 175, 55, 0.5); /* Gold border */
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8);
            cursor: pointer;
            transition: all 0.5s ease;
            /* Agar foto tidak terbalik saat di belakang */
            backface-visibility: hidden; 
        }

        .carousel-item img {
            width: 100%; height: 100%; object-fit: cover;
            filter: brightness(0.7); /* Redupkan yang tidak aktif */
            transition: 0.5s;
        }
        
        /* Item yang sedang aktif (di depan) */
        .carousel-item.active {
            border-color: var(--gold);
            box-shadow: 0 20px 50px rgba(212, 175, 55, 0.3);
        }
        .carousel-item.active img, .carousel-item:hover img {
            filter: brightness(1.1);
            transform: scale(1.05);
        }

        /* Animations */
        @keyframes fadeUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }

        /* Responsive adjustments */
        @media(max-width: 768px) {
            .hero-title { font-size: 3rem; }
            .carousel-viewport {
                width: 300px; height: 300px; bottom: 10%; right: 0%; left: 0%; margin: auto;
            }
            .carousel-item { width: 120px; height: 180px; margin-top:-90px; margin-left:-60px; }
        }
    </style>
</head>
<body data-page="gallery">

    <div id="global-header-container"></div>

    <div id="bg-back" class="bg-layer"></div>
    <div id="bg-front" class="bg-layer"></div>
    <div class="bg-overlay"></div>

    <div class="hero-content">
        <span class="hero-subtitle" id="gallery_subtitle">Visual Journey</span>
        <h1 class="hero-title" id="gallery_title">Spencer's Collection</h1>
    </div>

    <div class="carousel-viewport">
        <div class="carousel-stage" id="carousel-stage">
            </div>
    </div>

    <script>
        let images = [];
        let currentAngle = 0;
        let currentIndex = 0;
        const stage = document.getElementById('carousel-stage');
        const bgBack = document.getElementById('bg-back');
        const bgFront = document.getElementById('bg-front');
        let isFrontActive = false; // Toggle untuk background layers

        // --- 1. LOAD DATA ---
        fetch('data.json?t=' + new Date().getTime())
        .then(r => r.json())
        .then(data => {
            // Update Titles
            if(data.gallery_title) document.getElementById('gallery_title').innerText = data.gallery_title;
            if(data.gallery_subtitle) document.getElementById('gallery_subtitle').innerText = data.gallery_subtitle;

            // Kumpulkan images dari JSON (Maksimal 12 slot)
            for (let i = 1; i <= 12; i++) {
                if(data[`img_gallery_${i}`]) images.push(data[`img_gallery_${i}`]);
            }
            // Fallback jika data kosong
            if (images.length === 0) images = ["assets/room1.jpg", "assets/room2.jpg", "assets/dining-bg.jpg"];

            // Inisialisasi Galeri
            initGallery();
        });

        // --- 2. SETUP GALLERY ---
        function initGallery() {
            const total = images.length;
            // Radius: Jarak item dari pusat putaran. Makin besar makin lebar lingkarannya.
            const radius = window.innerWidth < 768 ? 180 : 280; 
            const angleStep = 360 / total;

            images.forEach((src, idx) => {
                const item = document.createElement('div');
                item.className = `carousel-item ${idx === 0 ? 'active' : ''}`;
                // Tempatkan item melingkar berdasarkan index
                item.style.transform = `rotateY(${idx * angleStep}deg) translateZ(${radius}px)`;
                item.innerHTML = `<img src="${src}" alt="Gallery ${idx}">`;
                
                // Event Klik: Putar carousel & ganti background
                item.onclick = () => rotateToItem(idx);
                
                stage.appendChild(item);
            });

            // Set background awal
            bgBack.style.backgroundImage = `url('${images[0]}')`;
        }

        // --- 3. ROTATION LOGIC ---
        function rotateToItem(index) {
            if (index === currentIndex) return; // Jangan lakukan apa2 jika klik item yg sama

            const total = images.length;
            const angleStep = 360 / total;

            // Hitung sudut target agar item yang diklik menghadap depan (0 derajat)
            // Kita gunakan negatif karena stage berputar berlawanan arah jarum jam
            const targetAngle = -1 * index * angleStep; 
            
            // --- Logika Putaran Terdekat (Shortest Path) ---
            // Ini mencegah carousel berputar liar (misal dari item 1 ke 12 mutar 360deg)
            let delta = targetAngle - currentAngle;
            // Normalisasi delta ke range -180 sampai 180
            while (delta <= -180) delta += 360;
            while (delta > 180) delta -= 360;
            
            currentAngle += delta; // Update sudut global

            // Terapkan Transformasi 3D (Pertahankan kemiringan TikTok + Sudut baru)
            stage.style.transform = `rotateX(-10deg) rotateY(${currentAngle - 20}deg) rotateZ(5deg)`;

            // Update Active Class
            document.querySelectorAll('.carousel-item').forEach(el => el.classList.remove('active'));
            stage.children[index].classList.add('active');

            currentIndex = index;
            changeBackground(images[index]);
        }

        // --- 4. BACKGROUND TRANSITION (CROSS-FADE) ---
        function changeBackground(newSrc) {
            const url = `url('${newSrc}')`;
            
            if (isFrontActive) {
                // Front sedang aktif, siapkan Back, lalu fade-out Front
                bgBack.style.backgroundImage = url;
                bgFront.style.opacity = 0;
                isFrontActive = false;
            } else {
                // Back sedang aktif, siapkan Front, lalu fade-in Front
                bgFront.style.backgroundImage = url;
                bgFront.style.opacity = 1;
                isFrontActive = true;
            }
        }

        // --- Optional: Auto Rotate pelan jika tidak ada interaksi ---
        // let autoRotate = setInterval(() => rotateToItem((currentIndex + 1) % images.length), 5000);
        // stage.addEventListener('mouseenter', () => clearInterval(autoRotate));
    </style>
</body>
</html>
