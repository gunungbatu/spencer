<script>
    // 1. LOAD DATA DARI JSON
    fetch('data.json?t=' + Date.now()).then(r => r.json()).then(data => {
        const vid = document.getElementById('heroVideo');
        const slider = document.getElementById('heroSlider');
        if(data.hero_type === 'slider') {
            vid.style.display = 'none';
            slider.style.display = 'block';
            if(data.img_hero_slide_1) document.getElementById('slide1').style.backgroundImage = `url('${data.img_hero_slide_1}')`;
            if(data.img_hero_slide_2) document.getElementById('slide2').style.backgroundImage = `url('${data.img_hero_slide_2}')`;
            if(data.img_hero_slide_3) document.getElementById('slide3').style.backgroundImage = `url('${data.img_hero_slide_3}')`;
            startSlider();
        } else {
            slider.style.display = 'none';
            vid.src = data.hero_video;
        }

        Object.keys(data).forEach(key => {
            const el = document.getElementById(key);
            if (el) {
                if (key.startsWith('img_') || key.endsWith('_img')) el.src = data[key];
                else if (!key.startsWith('social_')) el.innerText = data[key];
            }
        });

        if(data.room_deluxe_video) document.getElementById('btn_tour_deluxe').onclick = () => openTour(data.room_deluxe_video);
        if(data.room_superior_video) document.getElementById('btn_tour_superior').onclick = () => openTour(data.room_superior_video);
        if(data.room_executive_video) document.getElementById('btn_tour_executive').onclick = () => openTour(data.room_executive_video);
    });

    // 2. LOGIKA BOOKING ENGINE
    function checkRooms() {
        const checkIn = document.getElementById('checkIn').value;
        const checkOut = document.getElementById('checkOut').value;
        const loader = document.getElementById('searchLoader');
        const resultArea = document.getElementById('roomResultArea');
        const roomSelect = document.getElementById('roomSelect');

        if (!checkIn || !checkOut) {
            alert("Silakan pilih tanggal check-in dan check-out.");
            return;
        }

        if (new Date(checkIn) >= new Date(checkOut)) {
            alert("Tanggal Check-out harus setelah tanggal Check-in.");
            return;
        }

        loader.style.display = 'block';
        document.getElementById('btnSearch').disabled = true;

        // Simulasi pengecekan ketersediaan (2 detik)
        setTimeout(() => {
            loader.style.display = 'none';
            resultArea.style.display = 'block';
            document.getElementById('btnSearch').disabled = false;
            
            // Isi dropdown kamar secara dinamis
            const rooms = ["Deluxe Room", "Superior Room", "Executive Room"];
            roomSelect.innerHTML = rooms.map(r => `<option value="${r}">${r}</option>`).join('');
            
            document.getElementById('btnFinalSubmit').disabled = false;
        }, 1500);
    }

    function submitBooking() {
        const nama = document.getElementById('namaTamu').value;
        const wa = document.getElementById('waTamu').value;
        const checkIn = document.getElementById('checkIn').value;
        const checkOut = document.getElementById('checkOut').value;
        const room = document.getElementById('roomSelect').value;
        const promo = document.getElementById('promoCode').value || "-";

        if (!nama || !wa) {
            alert("Mohon lengkapi Nama dan nomor WhatsApp Anda.");
            return;
        }

        const loader = document.getElementById('submitLoader');
        loader.style.display = 'block';

        // Ganti nomor ini dengan nomor WA Spencer Green Hotel
        const phone = "628123456789"; 
        
        const message = `Halo Spencer Green Hotel, saya ingin reservasi:%0A%0A` +
                        `*Nama:* ${nama}%0A` +
                        `*WA:* ${wa}%0A` +
                        `*Kamar:* ${room}%0A` +
                        `*Check In:* ${checkIn}%0A` +
                        `*Check Out:* ${checkOut}%0A` +
                        `*Promo:* ${promo}`;

        setTimeout(() => {
            window.open(`https://wa.me/${phone}?text=${message}`, '_blank');
            loader.style.display = 'none';
            closeBooking();
        }, 1000);
    }

    // 3. FUNGSI UI LAINNYA
    function startSlider() {
        let slides = document.querySelectorAll('.hero-slide');
        let i = 0;
        if(slides.length) slides[0].classList.add('active');
        setInterval(() => {
            slides[i].classList.remove('active');
            i = (i+1)%slides.length;
            slides[i].classList.add('active');
        }, 5000);
    }

    function openTour(src) {
        const modal = document.getElementById('tourModal');
        const vid = document.getElementById('tourVideo');
        if(!src) return alert("Video belum tersedia.");
        vid.src = src;
        modal.classList.add('active');
        vid.play();
    }

    function closeTour() {
        const modal = document.getElementById('tourModal');
        const vid = document.getElementById('tourVideo');
        vid.pause();
        vid.src = "";
        modal.classList.remove('active');
    }

    function openBooking() { document.getElementById('bookingModal').classList.add('active'); }
    function closeBooking() { document.getElementById('bookingModal').classList.remove('active'); }

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('checkIn').setAttribute('min', today);
        document.getElementById('checkOut').setAttribute('min', today);
    });
</script>
