<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spencer Green Hotel Batu</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="assets/js/global-config.js"></script>

    <style>
        /* --- CORE CSS --- */
        :root { --gold: #D4AF37; --emerald: #1B4D3E; --dark: #1a1a1a; --light: #F9F9F9; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Montserrat', sans-serif; color: #4a4a4a; overflow-x: hidden; background: var(--light); }
        h1, h2, h3 { font-family: 'Cormorant Garamond', serif; color: var(--dark); }
        a { text-decoration: none; transition: 0.3s; }
        
        /* --- NAVBAR --- */
        header { position:fixed; top:0; width:100%; padding:20px 50px; display:flex; justify-content:space-between; align-items:center; z-index:1000; transition:0.4s; background:linear-gradient(to bottom, rgba(0,0,0,0.7), transparent); }
        header.scrolled { background:var(--emerald); padding:15px 50px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
        .logo { color:#fff; font-family:'Cormorant Garamond', serif; font-size:1.8rem; font-weight:600; text-transform:uppercase; letter-spacing:2px; }
        .nav-menu { display:flex; gap:30px; list-style:none; }
        .nav-link { color:#fff; text-transform:uppercase; font-size:0.75rem; letter-spacing:1.5px; font-weight:500; }
        .btn-book { background:var(--gold); color:#fff; padding:10px 25px; text-transform:uppercase; font-size:0.75rem; border:1px solid var(--gold); cursor:pointer; font-weight:600; }
        .btn-book:hover { background:transparent; color:var(--gold); }
        
        /* --- MOBILE MENU --- */
        .mobile-menu-btn { display:none; color:#fff; font-size:1.5rem; cursor:pointer; z-index:1001; }
        .mobile-nav-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(27,77,62,0.95); z-index:1000; display:flex; flex-direction:column; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:0.4s; }
        .mobile-nav-overlay.active { opacity:1; pointer-events:auto; }
        .mobile-nav-link { color:#fff; font-size:1.5rem; margin:15px 0; font-family:'Cormorant Garamond', serif; }

        /* --- HERO SECTION --- */
        .hero { position:relative; height:100vh; display:flex; align-items:center; justify-content:center; text-align:center; overflow:hidden; }
        .hero-content { position:relative; z-index:2; color:#fff; text-shadow:0 4px 15px rgba(0,0,0,0.5); animation: fadeUp 1.5s ease-out; }
        .hero-title { font-size:5rem; line-height:1; letter-spacing:5px; margin:10px 0; color:#fff; text-transform: uppercase; }
        .hero-subtitle { font-size: 1rem; letter-spacing: 4px; text-transform: uppercase; font-weight: 600; }
        
        /* Video & Slider Background */
        .video-bg { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-2; }
        .hero-slider { position:absolute; top:0; left:0; width:100%; height:100%; z-index:-2; display:none; }
        .hero-slide { position:absolute; top:0; left:0; width:100%; height:100%; background-size:cover; background-position:center; opacity:0; transition:opacity 1.5s; }
        .hero-slide.active { opacity:1; }
        .hero::before { content:''; position:absolute; inset:0; background:rgba(0,0,0,0.3); z-index:-1; }

        /* --- SECTIONS --- */
        .section-separator { padding: 80px 20px 40px; text-align: center; }
        .section-separator h2 { font-size: 3rem; margin-bottom: 10px; }
        .full-section { display: flex; flex-direction: column; width: 100%; }
        
        /* --- REVIEW SECTION --- */
        .review-section { padding: 50px 20px; background: #fff; text-align: center; }
        .review-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; max-width: 1200px; margin: 40px auto; }
        .review-card { background: #f9f9f9; padding: 30px; border-radius: 10px; text-align: left; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .review-source-icon { position: absolute; top: 20px; right: 20px; font-size: 1.2rem; }
        .fa-google { color: #4285F4; }
        .review-text { font-style: italic; color: #555; margin: 15px 0; min-height: 60px; }
        .review-name { font-weight: bold; color: var(--emerald); text-transform: uppercase; font-size: 0.9rem; }
        
        /* --- FOOTER --- */
        footer { background:var(--emerald); color:#fff; padding:50px; text-align:center; }
        .social-box { display:flex; justify-content:center; gap:20px; margin-top:20px; }
        .social-icon { color:#fff; width:40px; height:40px; border:1px solid rgba(255,255,255,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center; transition:0.3s; text-decoration:none; }
        .social-icon:hover { background:var(--gold); border-color:var(--gold); transform: translateY(-3px); }
        .hidden { display:none !important; }

        /* --- BOOKING MODAL --- */
        .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:2000; justify-content:center; align-items:center; opacity:0; transition:0.3s; }
        .modal-overlay.active { display:flex; opacity:1; }
        .booking-box { background:#fff; padding:40px; width:90%; max-width:500px; position:relative; border-top:5px solid var(--gold); max-height:90vh; overflow-y:auto; border-radius: 8px; }
        .form-group { margin-bottom:15px; }
        .form-label { display:block; font-size:0.75rem; text-transform:uppercase; font-weight:600; color:var(--emerald); margin-bottom:5px; }
        .form-input, .form-select { width:100%; padding:12px; border:1px solid #ddd; font-family:inherit; border-radius:4px; }
        .btn-submit { width:100%; padding:15px; background:var(--gold); color:#fff; border:none; cursor:pointer; font-weight:bold; letter-spacing:1px; text-transform:uppercase; margin-top:10px; border-radius:4px; }
        .btn-submit:disabled { background:#ccc; cursor:not-allowed; }

        /* RESPONSIVE */
        @media (max-width:900px) {
            .nav-menu, .btn-book { display:none; }
            .mobile-menu-btn { display:block; }
            .hero-title { font-size:3rem; }
        }
        @keyframes fadeUp { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }
    </style>
</head>
<body>

    <header id="navbar">
        <div class="logo">Spencer Green</div>
        <ul class="nav-menu">
            <li><a href="index.html" class="nav-link" style="border-bottom: 1px solid var(--gold);">Home</a></li>
            <li><a href="dining.html" class="nav-link">Dining</a></li>
            <li><a href="meeting.html" class="nav-link">Events</a></li>
            <li><a href="wedding.html" class="nav-link">Wedding</a></li>
            <li><a href="gallery.html" class="nav-link">Gallery</a></li>
        </ul>
        <a href="#" onclick="openBooking()" class="btn-book">Book Now</a>
        <div class="mobile-menu-btn" onclick="toggleMobileMenu()">&#9776;</div>
    </header>

    <div class="mobile-nav-overlay" id="mobileNav">
        <a href="index.html" class="mobile-nav-link">Home</a>
        <a href="dining.html" class="mobile-nav-link">Dining</a>
        <a href="meeting.html" class="mobile-nav-link">Events</a>
        <a href="wedding.html" class="mobile-nav-link">Wedding</a>
        <a href="gallery.html" class="mobile-nav-link">Gallery</a>
        <a href="#" onclick="toggleMobileMenu(); openBooking()" class="mobile-nav-link" style="border:1px solid var(--gold); padding:10px 30px; margin-top:20px;">Book Now</a>
        <div style="position:absolute; top:30px; right:30px; color:#fff; font-size:2rem; cursor:pointer;" onclick="toggleMobileMenu()">&times;</div>
    </div>

    <section class="hero">
        <video id="heroVideo" autoplay muted loop playsinline class="video-bg"></video>
        
        <div id="heroSlider" class="hero-slider">
            <div class="hero-slide" id="slide1"></div>
            <div class="hero-slide" id="slide2"></div>
            <div class="hero-slide" id="slide3"></div>
        </div>
        
        <div class="hero-content">
            <p class="hero-subtitle">WELCOME TO</p>
            <h1 class="hero-title">SPENCER GREEN<br>HOTEL</h1>
        </div>
    </section>

    <div class="section-separator">
        <h2>Refined Luxury</h2>
        <p>A sanctuary above the clouds, harmonizing with nature.</p>
    </div>

    <section class="full-section">
        <div style="text-align: center; margin-bottom: 50px;">
            <a href="#" onclick="openBooking()" class="btn-book" style="color:var(--dark); border-color:var(--dark); background:transparent;">Check Room Availability</a>
        </div>
    </section>

    <section class="review-section">
        <h2>Guest Experiences</h2>
        <div class="review-grid" id="reviewContainer">
            <p>Loading reviews...</p>
        </div>
        <button onclick="document.getElementById('reviewFormArea').style.display='block'" class="btn-book" style="margin-top:30px; background:#333; border-color:#333;">Write a Review</button>

        <div id="reviewFormArea" style="display:none; max-width:500px; margin:30px auto; background:#fff; padding:20px; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
            <form id="guestReviewForm" onsubmit="submitReview(event)">
                <div class="form-group"><input type="text" name="name" class="form-input" placeholder="Your Name" required></div>
                <div class="form-group">
                    <select name="rating" class="form-select">
                        <option value="5">⭐⭐⭐⭐⭐</option>
                        <option value="4">⭐⭐⭐⭐</option>
                    </select>
                </div>
                <div class="form-group"><textarea name="comment" class="form-input" placeholder="Share your experience..." required></textarea></div>
                <button type="submit" class="btn-submit">Submit</button>
            </form>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 Spencer Green Hotel. All Rights Reserved.</p>
        <div class="social-box">
            <a id="soc_ig" href="#" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
            <a id="soc_tt" href="#" target="_blank" class="social-icon"><i class="fab fa-tiktok"></i></a>
            <a id="soc_yt" href="#" target="_blank" class="social-icon"><i class="fab fa-youtube"></i></a>
            <a id="soc_fb" href="#" target="_blank" class="social-icon"><i class="fab fa-facebook-f"></i></a>
            <a id="soc_wa" href="#" target="_blank" class="social-icon"><i class="fab fa-whatsapp"></i></a>
        </div>
    </footer>

    <div class="modal-overlay" id="bookingModal">
        <div class="booking-box">
            <span onclick="closeBooking()" style="position:absolute; right:20px; top:15px; cursor:pointer; font-size:1.5rem; color:#999;">&times;</span>
            <h3 style="text-align:center; margin-bottom:20px; font-family:'Cormorant Garamond', serif;">Reserve Your Stay</h3>
            
            <form id="resForm">
                <div style="display:flex; gap:10px;">
                    <div class="form-group" style="flex:1">
                        <label class="form-label">Check In</label>
                        <input type="date" id="checkIn" class="form-input">
                    </div>
                    <div class="form-group" style="flex:1">
                        <label class="form-label">Check Out</label>
                        <input type="date" id="checkOut" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Promo Code</label>
                    <input type="text" id="promoCode" class="form-input" placeholder="e.g. VIP10" style="text-transform:uppercase;">
                </div>
                
                <button type="button" onclick="checkRooms()" id="btnSearch" class="btn-submit" style="background:#333;">Search Availability</button>
                <div id="loader" style="display:none; text-align:center; margin-top:10px; color:var(--gold);">Checking database...</div>

                <div id="resultArea" style="margin-top:20px; display:none; border-top:1px solid #eee; padding-top:20px;">
                    <div class="form-group">
                        <label class="form-label">Available Rooms</label>
                        <select id="roomSelect" class="form-select"></select>
                    </div>
                    <div class="form-group"><input type="text" id="guestName" class="form-input" placeholder="Full Name"></div>
                    <div class="form-group"><input type="text" id="guestWA" class="form-input" placeholder="WhatsApp Number"></div>
                    <div class="form-group"><input type="email" id="guestEmail" class="form-input" placeholder="Email Address"></div>
                    
                    <button type="button" onclick="submitBooking()" id="btnFinal" class="btn-submit">Confirm Booking</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 1. DATA LOADER (Content & Settings)
        fetch('data.json')
        .then(r => r.json())
        .then(data => {
            // Text Content
            if(data.hero_title) document.querySelector('.hero-title').innerHTML = data.hero_title;
            if(data.hero_subtitle) document.querySelector('.hero-subtitle').innerText = data.hero_subtitle;
            
            // Hero Logic (Video vs Slider)
            const vid = document.getElementById('heroVideo');
            const slider = document.getElementById('heroSlider');
            
            if(data.hero_type === 'slider') {
                vid.style.display = 'none';
                slider.style.display = 'block';
                if(data.img_hero_slide_1) document.getElementById('slide1').style.backgroundImage = `url('${data.img_hero_slide_1}')`;
                if(data.img_hero_slide_2) document.getElementById('slide2').style.backgroundImage = `url('${data.img_hero_slide_2}')`;
                if(data.img_hero_slide_3) document.getElementById('slide3').style.backgroundImage = `url('${data.img_hero_slide_3}')`;
                startSlider();
            } else {
                slider.style.display = 'none';
                vid.src = data.hero_video;
            }

            // Social Media Links
            updateLink('soc_ig', data.social_instagram);
            updateLink('soc_tt', data.social_tiktok);
            updateLink('soc_yt', data.social_youtube);
            updateLink('soc_fb', data.social_facebook);
            updateLink('soc_wa', data.social_whatsapp);
        })
        .catch(e => console.log("Data load error", e));

        function updateLink(id, url) {
            const el = document.getElementById(id);
            if(url && url !== "#") el.href = url; else el.classList.add('hidden');
        }

        function startSlider() {
            let slides = document.querySelectorAll('.hero-slide');
            let i = 0;
            if(slides.length) slides[0].classList.add('active');
            setInterval(() => {
                slides[i].classList.remove('active');
                i = (i+1)%slides.length;
                slides[i].classList.add('active');
            }, 5000);
        }

        // 2. REVIEWS LOADER
        fetch('reviews.json')
        .then(r => r.json())
        .then(data => {
            const container = document.getElementById('reviewContainer');
            const active = data.filter(r => r.visible === true).slice(0, 3);
            if(active.length > 0) {
                container.innerHTML = '';
                active.forEach(r => {
                    let icon = (r.source === 'google') ? '<i class="fab fa-google review-source-icon"></i>' : '<i class="fas fa-globe review-source-icon"></i>';
                    let stars = '⭐'.repeat(r.rating);
                    container.innerHTML += `
                        <div class="review-card">
                            ${icon}
                            <div style="color:#f1c40f; margin-bottom:10px;">${stars}</div>
                            <p class="review-text">"${r.comment}"</p>
                            <div class="review-name">- ${r.name}</div>
                        </div>`;
                });
            } else {
                container.innerHTML = '<p>No reviews yet.</p>';
            }
        });

        function submitReview(e) {
            e.preventDefault();
            const form = document.getElementById('guestReviewForm');
            const formData = new FormData(form);
            formData.append('action', 'submit_guest');

            fetch('reviews_api.php', { method: 'POST', body: formData })
            .then(r => r.json())
            .then(res => {
                alert(res.message);
                form.reset();
                document.getElementById('reviewFormArea').style.display='none';
            });
        }

        // 3. UI INTERACTIONS
        window.onscroll = () => document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
        function toggleMobileMenu() { document.getElementById('mobileNav').classList.toggle('active'); }
        function openBooking() { document.getElementById('bookingModal').classList.add('active'); }
        function closeBooking() { document.getElementById('bookingModal').classList.remove('active'); }

        // 4. BOOKING ENGINE
        function checkRooms() {
            // Cek Config dulu
            if(typeof CONFIG === 'undefined' || !CONFIG.API_URL) {
                loadConfig().then(() => checkRooms());
                return;
            }

            const cin = document.getElementById('checkIn').value;
            const cout = document.getElementById('checkOut').value;
            const promo = document.getElementById('promoCode').value;

            if(!cin || !cout) return alert("Please select dates");
            if(cin >= cout) return alert("Check-out must be after Check-in");

            document.getElementById('loader').style.display = 'block';
            document.getElementById('btnSearch').disabled = true;

            fetch(CONFIG.API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "search", checkIn: cin, checkOut: cout, promoCode: promo })
            })
            .then(r => r.json())
            .then(res => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('btnSearch').disabled = false;
                
                const sel = document.getElementById('roomSelect');
                sel.innerHTML = '<option value="">-- Select Room --</option>';
                
                if(res.status === 'success' && res.data.length > 0) {
                    res.data.forEach(room => {
                        let priceText = `Rp ${room.totalPrice.toLocaleString()}`;
                        if(room.totalPrice < room.normalPrice) priceText += ` (Disc applied)`;
                        
                        let opt = document.createElement('option');
                        opt.value = room.name;
                        opt.text = `${room.name} - ${priceText}`;
                        opt.dataset.price = room.totalPrice;
                        sel.appendChild(opt);
                    });
                    document.getElementById('resultArea').style.display = 'block';
                    if(promo && res.data[0].totalPrice < res.data[0].normalPrice) alert("Promo Code Applied!");
                } else {
                    alert("No rooms available for these dates.");
                }
            })
            .catch(e => {
                document.getElementById('loader').style.display = 'none';
                alert("Connection error. Please try again.");
            });
        }

        function submitBooking() {
            // 1. AMBIL DATA DARI FORM
            const roomVal = document.getElementById('roomSelect').value;
            const sel = document.getElementById('roomSelect');
            const priceRaw = sel.options[sel.selectedIndex].dataset.price;
            
            // Format Harga jadi Rp (misal: "Rp 1.500.000") untuk email
            const priceFormatted = "Rp " + parseInt(priceRaw).toLocaleString('id-ID');

            const name = document.getElementById('guestName').value;
            const wa = document.getElementById('guestWA').value;
            const email = document.getElementById('guestEmail').value;
            const cin = document.getElementById('checkIn').value;
            const cout = document.getElementById('checkOut').value;

            // Validasi
            if(!roomVal || !name || !wa || !email) return alert("Mohon lengkapi Nama, WA, dan Email.");

            // Tombol Loading
            const btn = document.getElementById('btnFinal');
            btn.disabled = true;
            btn.innerText = "Processing...";

            // 2. KIRIM KE GOOGLE SHEETS (Backend Database)
            // Gunakan API URL dari Config
            if(CONFIG.API_URL) {
                fetch(CONFIG.API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        action: "book", 
                        nama: name, 
                        email: email, 
                        whatsapp: wa, 
                        checkIn: cin, 
                        checkOut: cout, 
                        kamar: roomVal, 
                        totalHarga: priceRaw // Ke Sheet kirim angka murni
                    })
                });
            }

            // 3. KIRIM EMAIL (Panggil send_email.php)
            fetch('send_email.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    nama: name,
                    email: email,
                    whatsapp: wa,
                    checkIn: cin,
                    checkOut: cout,
                    kamar: roomVal,
                    totalHarga: priceFormatted // Ke Email kirim format Rupiah
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Email Status:", data.status);
            })
            .catch(err => console.error("Email Error:", err));

            // 4. REDIRECT KE WHATSAPP (Setelah jeda 1 detik agar fetch jalan dulu)
            setTimeout(() => {
                const msg = `Halo Spencer Green, saya mau konfirmasi booking:\n\nNama: ${name}\nKamar: ${roomVal}\nIn: ${cin}\nOut: ${cout}\nTotal: ${priceFormatted}\n\nMohon info pembayaran.`;
                const waNum = (CONFIG.WA) ? CONFIG.WA : "6281234567890";
                window.location.href = `https://wa.me/${waNum}?text=${encodeURIComponent(msg)}`;
            }, 1500);
        }
    </script>
</body>
</html>
